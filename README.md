# Malvarma: Secure Monero cold wallets for the truly paranoid
 
Malvarma aims to make Monero cold wallet generation easy and secure.
It caters to highly security-conscious people, but is designed to be easy for an average
user to use. When Malvarma is complete, a user will be able
to generate a cold wallet in just a few broad steps:

1. Download, verify, and burn the Malvarma image onto a microSD card.
2. Insert the card into a non-wireless
[Raspberry Pi Zero](https://www.raspberrypi.org/products/raspberry-pi-zero/),
plug it into a HDMI screen, and turn it on.
3. A mnemonic seed, private spend/view keys, and public address should
   automatically show up on the screen. Write it down and store it safely.
4. Following a visual guide, destroy particular components of the Raspberry
   Pi Zero using hand tools.

Yes - it is a little extreme to suggest that one destroy a perfectly functional
Raspberry Pi, but that decision is entirely up to you.

## What is a cold wallet?

If you wish to store moneroj [1] for a long period of time without spending
them, it is a good idea to put them in a cold wallet, also known as [cold
storage](https://www.investopedia.com/terms/c/cold-storage.asp). Cold wallets
are created and stored in a such a way that the only way to spend the funds in
them is to have physical access.  As such, they should only be kept offline,
and should be generated by devices which have never and will never be connected
to the Internet.

## Why not use some other tool?

There is nothing intrinsically wrong with existing solutions, such as
[moneromooo's offline wallet
generator](https://github.com/moneromooo-monero/monero-wallet-generator). It is
absolutely possible to use such tools securely. Malvarma only seeks to go
one step further to provide a solution which accounts for *both* hardware and
software security, while making the entire process as foolproof as possible.

## Why use Malvarma?

Unfortunately, it is not easy to create a cold wallet securely. Several
problems stand in the way, so Malvarma seeks to mitigate them.

### Network interfaces

**Problem:** A cold wallet should be generated using processes and
devices which have as few attack surfaces as possible. Network connectivity is one
such attack surface though which an attacker may (hypothetically) leverage to
extract private keys.

**Solution:** 
A cold wallet should be generated in an
[air-gapped](https://en.wikipedia.org/wiki/Air_gap_(networking)) device. While
it is possible to disable wireless adapters on most PCs or laptops, the
non-wireless version of the Raspberry Pi Zero is *always* air-gapped, so it
avoids this entire class of vulnerabilities.

Note that this only matters if you don't want to have to *trust* that your device
can indeed turn its wireless adapter off. Again, this is a guide for the highly
security-conscious, and assumes an extremely low risk appitite.

### Malware

**Problem:** A device may be infected with malware without the user knowing.
Even if a cold wallet is generated offline, sufficiently sophisticated malware
may transmit it to an adversary if the device gets online.

**Solution:** A legitimate copy of Malvarma will not contain malware, and it
will be possible to ensure that this is so. Each Malvarma image will be
cryptographically signed and users should verify it before use. More advanced
users will be able to inspect, reproduce, and verify that the published
Malvarma image is exactly as advertised.

### Data destruction

**Problem:** Traces of private keys may remain on one's device even if they are
deleted or after it is shut down. [2] [3] The only way to be absolutely sure is
device to generate your keys and physically destroy the device after use.
Although this is prudent, it is wasteful to destroy electronics, and disposing
electronic waste can harm the environment. 

**Solution:** A Raspberry Pi Zero only costs USD$5 and is very small. It is
therefore more economical and relatively less harmful to the environment to
destroy after use.

### Ease of use

**Problem:** It is not trivial to set up a secure computing environment.
Rather than go through the hassle of setting up a USB-bootable Linux
distribution on an airgapped device just to create a cold wallet, a
less-determined user may opt to do so on the system they regularly use, and
thereby defeat the purpose of the entire exercise.

**Solution:** Each Raspberry Pi Zero is the same as the next. By encapsulating
a wallet generator into a microSD image, Malvarma eliminates the problem of
installing software on an airgapped device. The goal is to make it plug-and-play.

## What about hardware wallets?

Some users find hardware wallets an acceptable alternative to cold wallets as
they strike a balance between usability and security. [4] Yet at the time of
writing (early January 2018), there are no commercially available hardware
wallets for Monero, although Ledger support is reportedly [in the
works](https://www.reddit.com/r/Monero/comments/7de2pj/ledger_hardware_wallet_monero_integration_some/).

Note: **Malvarma is not a hardware wallet**, and that it will not store any
generated wallets.

## Great, where's the code?

It's still under development.

## Building Malvarma

1) Install dependencies:

```bash
sudo apt install libguestfs-tools
```

2) Download and verify Raspbian Lite:

```bash
git clone git@github.com:weijiekoh/malvarma.git && \
cd malvarma && \
git clone git@github.com:weijiekoh/py2-monero-wallet-generator.git && \
wget https://downloads.raspberrypi.org/raspbian_lite/images/raspbian_lite-2017-12-01/2017-11-29-raspbian-stretch-lite.zip -O raspberry/2017-11-29-raspbian-stretch-lite.zip && \
wget https://downloads.raspberrypi.org/raspbian_lite/images/raspbian_lite-2017-12-01/2017-11-29-raspbian-stretch-lite.zip.sha256 -O raspberry/checksum.sha256 && \
cd raspberry && \
sha256sum -c checksum.sha256
```

If the `sha256sum` command fails, **do not continue**.

3) Modify the Raspbian image

`build.py` requires root permissions through `sudo` because it needs to mount the Raspbian image using `guestmount`.

```bash
unzip 2017-11-29-raspbian-stretch-lite.zip && \
cd .. && \
sudo python3 build.py
```

`build.py` configures the Raspberry Pi image as follows:

- Disables WiFi and Bluetooth (in case it's run on a wireless-enabled Raspberry Pi
- Removes some unnecessary system services
- TODO: install `rng-tools` and run `rngtest`
- Automatically run `python py2-monero-wallet-generator/gen_wallet.py` upon
  boot to generate and display the keys to a cold wallet 

4) Flash the image onto an SD card

Assuming that your SD card reader is at `/dev/mmcblk0`, run:

```bash
sudo dd bs=4M if=raspberry/2017-11-29-raspbian-stretch-lite.img of=/dev/mmcblk0 conv=fsync
```

## What does *malvarma* mean?

Malvarma is Espernanto for cold.

## Notes

[1] In Espernanto, *moneroj* is the plural of *monero*, or coin.

[2] A [cold boot attack](https://en.wikipedia.org/wiki/Cold_boot_attack), for
instance, may retrieve data computer memory even if it has been rebooted,
albeit within a timeframe of seconds to minutes.

[3] Some operating systems use on-disk swap files as temporary working memory
storage. Sensitive data, including private keys, [may find their way into swap
files](http://www.iusmentis.com/technology/encryption/crashcourse/security/),
and a determined adversary may be able to extract them.

[4] The [Ledger](https://www.ledgerwallet.com/products/ledger-nano-s), for instance,
uses a secure element to store private keys, which makes it easy to spend coins
without exposing any private keys.
